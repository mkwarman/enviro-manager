<html>
    <head>
        <title>Environment Manager</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                var socket = io.connect('http://' + document.domain + ':' + location.port + '/live');
                var updates = [];

                socket.on('sensor_update', function(msg) {
                    console.log("Received data:" + msg.data);

                    if(updates.length >= 10){
                        numbers.shift()
                    }

                    updates.push(msg.data);
                    updates_string = '';
                    for(var i = 0; i < updates.length; i++){
                        updates_string = updates_string + '<p>' + updates[i].toString() + '</p>'
                    }
                    $('#log').html(updates_string);
        </script>
    </head>
    <body>
        <h2>Sensor Status:</h2>
        <table style="width:100%">
            <tr>
                <th>Sensor</th>
                <th>Temperature</th>
                <th>Target Temperature</th>
                <th>Humidity</th>
                <th>Target Humidity</th>
                <th>Last Updated</th>
            </tr>
            {% for sensor in sensors %}
            <tr>
                <td>{{ sensor.name }}</td>
                <td>{{ sensor.temperature }}</td>
                <td>{{ sensor.target_temperature }}</td>
                <td>{{ sensor.humidity }}</td>
                <td>{{ sensor.target_humidity }}</td>
                <td>{{ sensor.last_updated }}</td>
            </tr>
            {% endfor %}
        </table>
        <hr>
        <h2>Appliance Status:</h2>
        <table style="width:100%">
            <tr>
                <th>Appliance</th>
                <th>Enabled</th>
                <th>Current Status</th>
                <th>Duty Cycle</th>
                <th>Duty Cycle Percent</th>
            </tr>
            {% for appliance in appliances %}
            <tr>
                <td>{{ appliance.name }}</td>
                <td>{{ appliance.enabled }}</td>
                <td>{{ appliance.status }}</td>
                <td>{{ appliance.duty_cycle }}</td>
                <td>{{ appliance.duty_cycle_percentage }}</td>
            </tr>
            {% endfor %}
        </table>
        <div id="log"></div>
    </body>
</html>
